{*** 팝업_비밀번호 간편등록 | goods/popup_new_password.html ***}
<!-- 비밀번호 간편등록 202010 -->
<link type="text/css" rel="stylesheet" href="/data/skin/front/mo_designart/css/common/common.css">
<div class="new_psw_bg member_cont">
	<div class="new_psw_wrap login_box">
		<a href="" class="new_psw_btn">닫기</a>
		<h2>신규 비밀번호 간편등록</h2>
		<p>
			듀먼이 고도몰 서비스를 이용한 리뉴얼 과정에서 암호화된 비밀번호는 이전하지 못하였습니다.
			<strong>반드시 듀먼회원분들은 비밀번호를 신규 등록해야 로그인이 가능합니다.</strong>
			<br>이용에 불편을 드려 대단히 죄송합니다.
		</p>
		<form id="formUserCheck"  method="post" ><!--  target ="ifrmProcess"  action="../member/member_ps.php"-->
			<input type="hidden" name="mode" value="finder">


			<div class="new_psw_line1">
				<div class="input_wrap">
					<div class="input_title required"><label for="user_id">{=__('아이디')}</label></div>
					<div class="input_content">
					<input type="text" name="user_id" id="user_id" />
					</div>
					</div>
						<div class="input_wrap">
						<div class="input_title required"><label for="user_nm">{=__('이름')}</label></div>
						<div class="input_content">
							<input type="text"  name="user_nm" id="user_nm" />
						</div>
					</div>
					<div class="input_wrap">
						<div class="input_title required"><label for="cellPhone">{=__('휴대폰번호')}</label></div>
						<div class="input_content">
							<input type="text" name="user_phone" id="user_phone" placeholder="{=__('010-1234-5678')}">
						</div>
					</div>
					<div class="submit">
						<button type="button" class="cart_select_del_btn" id="cart_select_del_btn">인증하기</button>
					</div>
					<p class="caution_msg" style="text-align: center;color: red;font-weight: bold;margin-top: 0px;"></p>
			</div>
		</form>
		<form id="formUserCheck2" method="post"> <!--  action="../member/member_ps.php" -->
			<input type="hidden" name="mode" value="userPwChange">
			<input type="hidden" name="change_id" id="change_id" value="">
			<input type="hidden" name="change_nm" id="change_nm" value="">
			<input type="hidden" name="change_phone" id="change_phone" value="">

			<div class="new_psw_line2">
			<div class="input_wrap { ? isPaycoJoin || isThirdParty || isNaverJoin  || isKakaoJoin || isWonderJoin }dn{ / }">
			<div class="input_title required"><label for="newPassword">{=__('신규 비밀번호')}</label></div>
			<input type="text" name="reset_user_pw" id="reset_user_pw" placeholder="{=__('비밀번호')}" disabled>
		</form>
	</div>
		<div class="submit">
					<button type="button" class="member_login_order_btn" id="save_pw" disabled>등록하기</button>
				</div>
		</div>
		<ul class="login_find">			
			<li><a href="../member/join_method.php">{=__('회원가입')}</a></li>
			<li><a href="../member/find_id.php">{=__('아이디찾기')}</a></li>
			<li><a href="../member/find_password.php">네이버로그인</a></li>
		</ul>
		<div class="today_close">
			<input type="checkbox" />
			<span>오늘하루 그만보기</span>
		</div>
	</div>
<!-- //비밀번호 간편등록 202010 -->

<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
<script type="text/javascript">
	$(document).ready(function () {

		$("#cart_select_del_btn").click(function() {

			var userid = document.getElementById('user_id').value;
			var usernm = document.getElementById('user_nm').value;
			var userphone = document.getElementById('user_phone').value;

			if (userid == '')
			{
				alert("아이디를 입력해주세요.");
				return false;
			}else if (usernm == '')
			{
				alert("이름을 입력해주세요.");
				return false;
			}
			else if (userphone=='')
			{
				alert("핸드폰번호를 입력해주세요.");
				return false;
			}

			$.ajax({
				 url:"../member/member_ps.php"
				,data : {mode: "finder", user_id : userid, user_nm : usernm, user_phone : userphone}
				,type:"post"
				,dataType: "json"
				,success:function(data){

					console.log(data);
					
					if (data.passCheck == 'y') {

						//인증 완료시 비밀번호 설정 text, button disabled 해제
						$("#reset_user_pw").attr('disabled',false);
						$("#reset_user_submit").attr('disabled',false);

						$("#save_pw").attr('disabled',false);

						//인증 완료시 입력정보 disabled
						$("#user_id").attr('disabled',true);
						$("#user_nm").attr('disabled',true);
						$("#user_phone").attr('disabled',true);

						$("#cart_select_del_btn").attr('disabled',true);
						
					
						$('.caution_msg').empty().html("{=__('인증되었습니다.')}</span>");
					}
					else{
						$('.caution_msg').empty().html("{=__('일치하는 정보가 없습니다.')}</span>");
					}

				}
				,error:function(e) {
					alert(e.responseText);
				}
			});
		});

		$("#save_pw").click(function() {

			var userid = document.getElementById('user_id').value;
			var usernm = document.getElementById('user_nm').value;
			var userphone = document.getElementById('user_phone').value;

			var change_pw = document.getElementById('reset_user_pw').value;

console.log(change_pw);

			if (change_pw == '')
			{
				alert("비밀번호를 입력해주세요.");
				return false;
			}
			else{
				$.ajax({
					 url:"../member/member_ps.php"
					,data : {mode: "userPwChange", change_id : userid, change_nm : usernm, change_phone : userphone, reset_user_pw : change_pw}
					,type:"post"
					,dataType: "json"
					,success:function(data){
						alert("저장되었습니다.");
						window.close();
					}
					,error:function(e) {
						alert("저장되었습니다.");
						window.close();
					}
				});
			}
		});
	    
		//신규 비밀번호 등록 확인 체크
		/*
		$('#formUserCheck').validate({
			rules: {
				user_id: 'required',
				user_nm: 'required',
				user_phone: 'required',
			},
			messages: {
				user_id: {
					required: "{=__('아이디를 입력해주세요.')}"
				},
				user_nm: {
					required: "{=__('이름을 입력해주세요.')}"
				},
				user_phone: {
					required: "{=__('핸드폰 번호를 입력해주세요.')}",
					number: "{=__('숫자로만 입력해주세요.')}"
				}
			},
			submitHandler: function (form) {
				$.post(form.action, $(form).serializeObject()).done(function (data, textStatus, jqXhr) {
					console.log(data);
									
					if (data.passCheck == 'y') {

						//인증 완료시 비밀번호 설정 text, button disabled 해제
						$("#reset_user_pw").attr('disabled',false);
						$("#reset_user_submit").attr('disabled',false);

						//인증 완료시 입력정보 disabled
						$("#user_id").attr('disabled',true);
						$("#user_nm").attr('disabled',true);
						$("#user_phone").attr('disabled',true);

					} else {
						$('.js_caution_msg2').empty().html("{=__('주문자명과 주문번호가 일치하는 주문이 존재하지 않습니다. 다시 입력해 주세요.')}<br><span>{=__('주문번호와 비밀번호를 잊으신 경우, 고객센터로 문의하여 주시기 바랍니다.')}</span>");
					}
					
				});
				return false;
			}
		});
		*/

		//신규 비밀번호 재설정
		/*$('#formUserCheck2').validate({
			rules: {
				reset_user_pw: 'required'
			},
			messages: {
				reset_user_pw: {
					required: "{=__('비밀번호를 입력해주세요.')}"
				}
			},
			submitHandler: function (form) {

				var userid = document.getElementById('user_id').value;
				var usernm = document.getElementById('user_nm').value;
				var userphone = document.getElementById('user_phone').value;
				
				document.getElementById('change_id').value = userid;
				document.getElementById('change_nm').value = usernm;
				document.getElementById('change_phone').value = userphone;

				form.target = 'ifrmProcess';
				form.submit();
			}
		});
		*/

		
	});
</script>
